<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FBA Hub – Fantasy Brick Association</title>

  <style>
    :root{
      --bg:#05060a;
      --panel:#0c1020;
      --card:#0b0f1a;
      --card2:#0a0e18;
      --border:rgba(255,255,255,.08);
      --text:#f5f7ff;
      --muted:rgba(245,247,255,.65);

      /* Orange: bewusst gedämpft */
      --accent:#f08a2a;
      --accentSoft: rgba(240,138,42,.28);
      --accentSoft2: rgba(240,138,42,.18);
      --shadow: 0 18px 55px rgba(0,0,0,.55);

      --radius: 22px;
      --radius-sm: 14px;

      /* größere Schrift */
      --base: 17px;
      --h1: 28px;
      --h2: 18px;
      --h3: 14px;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
      font-size: var(--base);
      color: var(--text);
      background:
        radial-gradient(900px 480px at 15% 10%, rgba(240,138,42,.10), rgba(0,0,0,0) 55%),
        radial-gradient(900px 520px at 85% 30%, rgba(240,138,42,.08), rgba(0,0,0,0) 60%),
        radial-gradient(1000px 700px at 50% 85%, rgba(80,120,255,.08), rgba(0,0,0,0) 60%),
        var(--bg);
      min-height:100vh;
      padding: 22px;
      display:flex;
      justify-content:center;
    }

    .page{width:100%;max-width:1180px;display:flex;flex-direction:column;gap:18px}

    /* HERO */
    header.hero{
      position:relative;
      border-radius: 26px;
      padding: 22px 22px;
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: var(--shadow);
      overflow:hidden;

      /* gedämpftes Orange, nicht „zu krass“ */
      background:
        radial-gradient(900px 400px at 10% 0%, rgba(240,138,42,.28), rgba(0,0,0,0) 55%),
        linear-gradient(135deg, rgba(240,138,42,.22), rgba(20,10,10,.25) 40%, rgba(0,0,0,0) 80%),
        rgba(10,12,18,.70);
      backdrop-filter: blur(10px);
    }

    .heroRow{display:grid;grid-template-columns: 1.2fr .9fr; gap:18px; align-items:stretch}
    .heroLeft{display:flex;flex-direction:column;gap:10px}
    .heroTitle{font-size: var(--h1); font-weight: 900; letter-spacing:.6px}
    .heroSub{color: var(--muted); line-height:1.35}

    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:2px}
    .chip{
      font-size: 12.5px;
      color: rgba(255,255,255,.82);
      border: 1px solid rgba(255,255,255,.12);
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(0,0,0,.20);
    }

    /* Podcast Card */
    .podCard{
      border-radius: 20px;
      border:1px solid rgba(255,255,255,.10);
      background:
        /* rechts oben nicht zu dunkel */
        radial-gradient(700px 260px at 85% 0%, rgba(240,138,42,.14), rgba(0,0,0,0) 55%),
        rgba(0,0,0,.20);
      padding: 14px 14px;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      display:flex;
      flex-direction:column;
      gap:10px;
      min-height: 175px;
    }
    .podHead{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .podTitle{font-weight:800;font-size:14px}
    .pill{
      font-size:11px;
      padding:3px 8px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(240,138,42,.10);
      color: rgba(255,255,255,.85);
      letter-spacing:.4px;
    }
    .podHint{font-size:12.5px;color: var(--muted); margin-top:-6px}

    .podFrameWrap{
      border-radius: 14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,.10);
      background: rgba(0,0,0,.18);
      flex:1;
      min-height: 108px;
      display:flex;
    }
    .podFrame{
      width:100%;
      height:100%;
      border:0;
    }

    /* GRID */
    .grid{display:grid;grid-template-columns: 1.2fr 1fr; gap:16px}
    .card{
      border-radius: var(--radius);
      border:1px solid rgba(255,255,255,.10);
      background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(0,0,0,.10)), rgba(7,10,16,.72);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .cardHead{
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      padding: 16px 16px 12px;
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    .cardTitle{font-weight:900;font-size: var(--h2); letter-spacing:.2px}
    .cardSub{font-size:13px;color: var(--muted); margin-top:2px}
    .tag{
      font-size:11px;
      color: rgba(255,255,255,.85);
      border:1px solid rgba(240,138,42,.35);
      background: rgba(240,138,42,.10);
      padding: 3px 8px;
      border-radius: 999px;
      letter-spacing:.5px;
    }

    /* tables */
    .table{
      width:100%;
      border-collapse:collapse;
    }
    .table th, .table td{
      padding: 10px 14px;
      border-bottom:1px solid rgba(255,255,255,.07);
      font-size: 14px;
      vertical-align:middle;
    }
    .table th{
      font-size: 12px;
      color: rgba(245,247,255,.70);
      text-transform:uppercase;
      letter-spacing:.9px;
      font-weight:800;
    }
    .rowFlex{display:flex;align-items:center;gap:10px}
    .teamName{font-weight:800;line-height:1.1}
    .muted{color: var(--muted)}
    .right{text-align:right}
    .center{text-align:center}

    /* Logo */
    .logo{
      width:24px;height:24px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.25);
      object-fit:cover;
      flex:0 0 24px;
    }
    .fallbackLogo{
      width:24px;height:24px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(240,138,42,.18);
      display:inline-flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      font-size:12px;
      color: rgba(255,255,255,.92);
      flex:0 0 24px;
    }

    /* PR toggle */
    .toggle{
      display:flex;
      gap:8px;
      align-items:center;
    }
    .toggle button{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.20);
      color: rgba(255,255,255,.85);
      padding: 6px 10px;
      border-radius: 999px;
      font-weight:900;
      font-size: 12px;
      letter-spacing:.3px;
    }
    .toggle button.active{
      border-color: rgba(240,138,42,.55);
      background: rgba(240,138,42,.14);
      color: rgba(255,255,255,.95);
    }

    /* mobile */
    @media (max-width: 980px){
      .heroRow{grid-template-columns: 1fr}
      .grid{grid-template-columns: 1fr}
    }
  </style>
</head>

<body>
  <div class="page">

    <header class="hero">
      <div class="heroRow">
        <div class="heroLeft">
          <div class="heroTitle">FANTASY BRICK ASSOCIATION</div>
          <div class="heroSub">FBA Hub – alle Zahlen, Serien und Power Rankings der Liga auf einen Blick.</div>
          <div class="chips">
            <div class="chip">Regular Season 25/26</div>
            <div class="chip">Beste Bilanz: <span id="chipBest">–</span></div>
            <div class="chip">Längste Serie: <span id="chipStreak">–</span></div>
          </div>
        </div>

        <div class="podCard">
          <div class="podHead">
            <div class="podTitle">FBA Podcast – aktuelle Folge</div>
            <div class="pill">PODCAST</div>
          </div>
          <div class="podHint">Direkt im Hub abspielbar.</div>
          <div class="podFrameWrap">
            <iframe
              class="podFrame"
              id="podFrame"
              src="https://open.spotify.com/embed/episode/5IFryO5ElCtLA9zNtCT2bf?"
              allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
              loading="lazy"
            ></iframe>
          </div>
        </div>
      </div>
    </header>

    <section class="grid">

      <!-- LIVE MATCHUPS -->
      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">LIVE MATCHUPS</div>
            <div class="cardSub">Auswärts | Score | Heim | Prognose</div>
          </div>
          <div class="tag">LIVE</div>
        </div>

        <table class="table" id="matchupsTable">
          <thead>
            <tr>
              <th>Auswärts</th>
              <th class="center">Score</th>
              <th>Heim</th>
              <th class="right">Prognose</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="4" class="muted">Daten werden geladen …</td></tr>
          </tbody>
        </table>
      </div>

      <!-- POWER RANKING -->
      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">POWER RANKING</div>
            <div class="cardSub">Switch zwischen PR und PR+ (Woche W-1)</div>
          </div>
          <div class="toggle">
            <button id="btnPR" class="active" type="button">PR</button>
            <button id="btnPRP" type="button">PR+</button>
          </div>
        </div>

        <table class="table" id="prTable">
          <thead>
            <tr>
              <th style="width:48px">#</th>
              <th>Team</th>
              <th class="right">Score</th>
              <th class="right" id="deltaHead" style="display:none">Δ</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="4" class="muted">Daten werden geladen …</td></tr>
          </tbody>
        </table>
      </div>

      <!-- STANDINGS -->
      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">AKTUELLE TABELLE</div>
            <div class="cardSub">Live-Standings inklusive Serien.</div>
          </div>
          <div class="tag">STANDINGS</div>
        </div>

        <table class="table" id="standingsTable">
          <thead>
            <tr>
              <th style="width:48px">#</th>
              <th>Team</th>
              <th class="center">Bilanz</th>
              <th class="right">W%</th>
              <th class="right">Serie</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="5" class="muted">Daten werden geladen …</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Roadmap -->
      <div class="card">
        <div class="cardHead">
          <div>
            <div class="cardTitle">COMING NEXT</div>
            <div class="cardSub">Hall of Fame, Ewige Tabelle, Rekorde – als nächster Block.</div>
          </div>
          <div class="tag">ROADMAP</div>
        </div>
        <div style="padding:14px 16px;color:var(--muted);line-height:1.45">
          Sobald PR & PR+ sauber live laufen, hängen wir die nächsten Export-Tabs dran.
        </div>
      </div>

    </section>
  </div>

<script>
  // =========================
  // KONFIG (nur hier ändern)
  // =========================
  const URLS = {
    matchups: "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=478155593&single=true&output=csv",
    standings: "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=683402103&single=true&output=csv",
    pr: "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=1192817047&single=true&output=csv",
    prp: "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=1541127392&single=true&output=csv"
  };

  // =========================
  // CSV Parser (robust genug)
  // =========================
  function parseCSV(text){
    const rows = [];
    let row = [];
    let cur = "";
    let inQuotes = false;

    for (let i=0; i<text.length; i++){
      const c = text[i];
      const n = text[i+1];

      if (c === '"' && inQuotes && n === '"'){ cur += '"'; i++; continue; }
      if (c === '"'){ inQuotes = !inQuotes; continue; }

      if (!inQuotes && c === ","){
        row.push(cur); cur=""; continue;
      }
      if (!inQuotes && (c === "\n" || c === "\r")){
        if (c === "\r" && n === "\n") i++;
        row.push(cur); cur="";
        if (row.some(v => String(v).trim() !== "")) rows.push(row);
        row = [];
        continue;
      }
      cur += c;
    }
    row.push(cur);
    if (row.some(v => String(v).trim() !== "")) rows.push(row);

    if (!rows.length) return [];
    const headers = rows[0].map(h => String(h).trim());
    return rows.slice(1).map(r=>{
      const obj = {};
      headers.forEach((h,idx)=> obj[h] = (r[idx] ?? "").trim());
      return obj;
    });
  }

  function normKey(k){
    return String(k||"").trim().toLowerCase().replace(/\s+/g,"_");
  }

  function pick(obj, keys){
    // keys: array of possible header names
    for (const k of keys){
      // direct
      if (obj[k] !== undefined) return obj[k];
      // normalized search
      const nk = normKey(k);
      for (const real in obj){
        if (normKey(real) === nk) return obj[real];
      }
    }
    return "";
  }

  // =========================
  // Logos (mit Leerzeichen!)
  // =========================
  function logoUrl(team){
    // Dateien heißen z.B. "BlackForest Mad Wolves.png"
    // -> Spaces müssen encoded werden.
    return "./logos/" + encodeURIComponent(team) + ".png";
  }

  function teamCell(team){
    const wrap = document.createElement("div");
    wrap.className = "rowFlex";

    const img = document.createElement("img");
    img.className = "logo";
    img.src = logoUrl(team);
    img.alt = team;

    // fallback wenn Logo nicht lädt
    img.onerror = () => {
      const fb = document.createElement("span");
      fb.className = "fallbackLogo";
      fb.textContent = (team || "?").trim().slice(0,1).toUpperCase();
      img.replaceWith(fb);
    };

    const name = document.createElement("div");
    name.className = "teamName";
    name.textContent = team;

    wrap.appendChild(img);
    wrap.appendChild(name);
    return wrap;
  }

  // =========================
  // LIVE MATCHUPS
  // =========================
  function splitIfCombined(str){
    const s = String(str||"").trim();
    // falls jemand "A vs. B" in away_team reinkopiert hat
    const m = s.match(/^(.*?)\s+vs\.\s+(.*)$/i);
    if (m) return { away: m[1].trim(), home: m[2].trim(), combined: true };
    return { away: s, home: "", combined: false };
  }

  async function loadMatchups(){
    const table = document.querySelector("#matchupsTable tbody");
    table.innerHTML = `<tr><td colspan="4" class="muted">Daten werden geladen …</td></tr>`;

    const res = await fetch(URLS.matchups, { cache: "no-store" });
    const txt = await res.text();
    const data = parseCSV(txt);

    table.innerHTML = "";

    data.forEach(row=>{
      let away = pick(row, ["away_team","away","auswaerts"]);
      let home = pick(row, ["home_team","home","heim"]);
      const score = pick(row, ["score"]);
      const proj = pick(row, ["projection","prognose"]);

      // Fix für dein aktuelles Problem: Erste Zeile enthält "A vs. B"
      const sp = splitIfCombined(away);
      if (sp.combined){
        away = sp.away;
        if (!home) home = sp.home;
      }

      const tr = document.createElement("tr");

      const tdAway = document.createElement("td");
      tdAway.appendChild(teamCell(away));

      const tdScore = document.createElement("td");
      tdScore.className = "center";
      tdScore.innerHTML = `<span style="display:inline-block;padding:4px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.18);font-weight:900">${score || "–"}</span>`;

      const tdHome = document.createElement("td");
      tdHome.appendChild(teamCell(home));

      const tdProj = document.createElement("td");
      tdProj.className = "right";
      tdProj.style.fontWeight = "900";
      tdProj.textContent = proj || "–";

      tr.appendChild(tdAway);
      tr.appendChild(tdScore);
      tr.appendChild(tdHome);
      tr.appendChild(tdProj);
      table.appendChild(tr);
    });

    if (!data.length){
      table.innerHTML = `<tr><td colspan="4" class="muted">Keine Matchup-Daten gefunden.</td></tr>`;
    }
  }

  // =========================
  // STANDINGS
  // =========================
  function pct(val){
    const n = Number(String(val).replace(",", "."));
    if (!isFinite(n)) return "–";
    // falls win_pct schon 0.679 ist:
    if (n <= 1) return (n*100).toFixed(1) + " %";
    return n.toFixed(1) + " %";
  }

  async function loadStandings(){
    const table = document.querySelector("#standingsTable tbody");
    table.innerHTML = `<tr><td colspan="5" class="muted">Daten werden geladen …</td></tr>`;

    const res = await fetch(URLS.standings, { cache: "no-store" });
    const txt = await res.text();
    const data = parseCSV(txt);

    table.innerHTML = "";

    data.forEach((row, idx)=>{
      const team = pick(row, ["team_name","team"]);
      const w = pick(row, ["W","wins"]);
      const l = pick(row, ["L","losses"]);
      const wp = pick(row, ["win_pct","w_pct","win%"]);
      const streak = pick(row, ["streak_label","streak"]);

      const tr = document.createElement("tr");

      const tdRank = document.createElement("td");
      tdRank.textContent = String(idx+1);
      tdRank.style.color = "rgba(245,247,255,.75)";
      tdRank.style.fontWeight = "900";

      const tdTeam = document.createElement("td");
      tdTeam.appendChild(teamCell(team));

      const tdWL = document.createElement("td");
      tdWL.className = "center";
      tdWL.style.fontWeight = "900";
      tdWL.textContent = (w && l) ? `${w}-${l}` : "–";

      const tdWP = document.createElement("td");
      tdWP.className = "right";
      tdWP.style.fontWeight = "900";
      tdWP.textContent = pct(wp);

      const tdStreak = document.createElement("td");
      tdStreak.className = "right";
      tdStreak.style.fontWeight = "900";
      tdStreak.textContent = streak || "–";

      tr.appendChild(tdRank);
      tr.appendChild(tdTeam);
      tr.appendChild(tdWL);
      tr.appendChild(tdWP);
      tr.appendChild(tdStreak);
      table.appendChild(tr);
    });

    // Chips oben (beste Bilanz + längste Serie) aus Standings ableiten
    if (data.length){
      const bestTeam = pick(data[0], ["team_name","team"]);
      document.getElementById("chipBest").textContent = bestTeam || "–";

      // längste Serie: einfach max absolute Zahl aus streak_label (z.B. "3-Siege")
      let bestStreak = { team:"", n:0, label:"" };
      data.forEach(r=>{
        const team = pick(r, ["team_name","team"]);
        const s = pick(r, ["streak_label","streak"]);
        const m = String(s).match(/(\d+)/);
        const n = m ? Number(m[1]) : 0;
        if (n > bestStreak.n){
          bestStreak = { team, n, label: s };
        }
      });
      document.getElementById("chipStreak").textContent = bestStreak.label ? `${bestStreak.team}` : "–";
    }
  }

  // =========================
  // POWER RANKING + PR+
  // =========================
  let prMode = "pr"; // "pr" | "prp"

  function setPRMode(mode){
    prMode = mode;
    document.getElementById("btnPR").classList.toggle("active", mode==="pr");
    document.getElementById("btnPRP").classList.toggle("active", mode==="prp");

    // Delta-Spalte nur bei PR+
    const showDelta = (mode === "prp");
    document.getElementById("deltaHead").style.display = showDelta ? "" : "none";
    loadPR();
  }

  async function loadPR(){
    const table = document.querySelector("#prTable tbody");
    table.innerHTML = `<tr><td colspan="4" class="muted">Daten werden geladen …</td></tr>`;

    const url = (prMode === "prp") ? URLS.prp : URLS.pr;
    const res = await fetch(url, { cache: "no-store" });
    const txt = await res.text();
    const data = parseCSV(txt);

    table.innerHTML = "";

    data.forEach(row=>{
      const rank = pick(row, ["rank","#"]);
      const team = pick(row, ["team_name","team"]);
      const score = pick(row, ["score"]);
      const delta = pick(row, ["delta","Δ"]);

      const tr = document.createElement("tr");

      const tdRank = document.createElement("td");
      tdRank.textContent = rank || "–";
      tdRank.style.color = "rgba(245,247,255,.75)";
      tdRank.style.fontWeight = "900";

      const tdTeam = document.createElement("td");
      tdTeam.appendChild(teamCell(team));

      const tdScore = document.createElement("td");
      tdScore.className = "right";
      tdScore.style.fontWeight = "900";
      tdScore.textContent = score || "–";

      const tdDelta = document.createElement("td");
      tdDelta.className = "right";
      tdDelta.style.fontWeight = "900";
      tdDelta.style.display = (prMode==="prp") ? "" : "none";

      if (prMode==="prp"){
        const d = String(delta || "0").trim();
        tdDelta.textContent = d;

        // optischer Punch bei nonzero
        if (d !== "0" && d !== "" && d !== "–"){
          tdDelta.style.color = "rgba(240,138,42,.95)";
        } else {
          tdDelta.style.color = "rgba(245,247,255,.75)";
        }
      }

      tr.appendChild(tdRank);
      tr.appendChild(tdTeam);
      tr.appendChild(tdScore);
      tr.appendChild(tdDelta);
      table.appendChild(tr);
    });

    if (!data.length){
      table.innerHTML = `<tr><td colspan="4" class="muted">Keine PR-Daten gefunden.</td></tr>`;
    }
  }

  // =========================
  // INIT
  // =========================
  document.getElementById("btnPR").addEventListener("click", ()=>setPRMode("pr"));
  document.getElementById("btnPRP").addEventListener("click", ()=>setPRMode("prp"));

  (async function init(){
    try{
      await Promise.all([
        loadMatchups(),
        loadStandings(),
      ]);
      await loadPR();
    }catch(e){
      console.error(e);
    }
  })();
</script>

</body>
</html>
