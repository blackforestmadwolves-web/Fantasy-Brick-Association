<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>FBA Hub – Fantasy Brick Association</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #05060a;
      --bg-alt: #101218;
      --card: #151822;
      --accent: #ff8a2a;
      --accent-soft: rgba(255, 138, 42, 0.15);
      --accent-border: rgba(255, 138, 42, 0.35);
      --text: #f5f5f7;
      --muted: #a0a3b1;
      --danger: #ff4b6a;
      --success: #4ade80;
      --border: #262938;
      --shadow-soft: 0 18px 55px rgba(0, 0, 0, 0.55);
      --radius-lg: 18px;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827 0, #020617 55%, #000 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      justify-content: center;
    }

    .page {
      width: 100%;
      max-width: 1200px;
    }

    header {
      background: linear-gradient(135deg, #ff8a2a 0%, #f97316 45%, #ea580c 100%);
      border-radius: 24px;
      padding: 20px 24px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 24px;
      box-shadow: var(--shadow-soft);
      margin-bottom: 24px;
    }

    .brand {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-width: 480px;
    }

    .brand-title {
      font-size: 28px;
      font-weight: 800;
      letter-spacing: 0.06em;
      text-transform: uppercase;
    }

    .brand-subtitle {
      font-size: 16px;
      opacity: 0.92;
    }

    .brand-meta {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 14px;
      opacity: 0.9;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(0, 0, 0, 0.2);
      background: rgba(0, 0, 0, 0.16);
      font-size: 13px;
    }

    .podcast-card {
      background: rgba(0, 0, 0, 0.18);
      border-radius: 18px;
      padding: 10px 12px;
      width: 320px;
      min-width: 260px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      border: 1px solid rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
    }

    .podcast-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .podcast-title {
      font-size: 15px;
      font-weight: 600;
    }

    .podcast-badge {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      border-radius: 999px;
      padding: 3px 8px;
      border: 1px solid rgba(255, 255, 255, 0.3);
      background: rgba(15, 23, 42, 0.9);
    }

    .podcast-iframe-wrapper {
      border-radius: 12px;
      overflow: hidden;
      border: 1px solid rgba(148, 163, 184, 0.5);
    }

    iframe {
      border: none;
      width: 100%;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .grid {
      display: grid;
      grid-template-columns: 2fr 1.5fr;
      gap: 20px;
    }

    .grid-3 {
      display: grid;
      grid-template-columns: 2fr 1.5fr;
      gap: 20px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(255, 138, 42, 0.12), transparent 55%),
                  radial-gradient(circle at bottom right, rgba(15, 23, 42, 0.9), #020617);
      border-radius: var(--radius-lg);
      padding: 16px 18px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
      gap: 10px;
    }

    .card-title {
      font-size: 19px;
      font-weight: 600;
      letter-spacing: 0.03em;
      text-transform: uppercase;
    }

    .card-subtitle {
      font-size: 13px;
      color: var(--muted);
    }

    .badge {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.09em;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid var(--accent-border);
      background: var(--accent-soft);
      color: var(--accent);
    }

    .section-body {
      font-size: 15px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }

    th, td {
      padding: 6px 6px;
      text-align: left;
      border-bottom: 1px solid #1f2937;
    }

    th {
      font-size: 13px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    tr:last-child td {
      border-bottom: none;
    }

    .team-cell {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .team-logo {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      object-fit: cover;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: #020617;
      flex-shrink: 0;
    }

    .team-name {
      font-size: 14px;
      font-weight: 500;
    }

    .muted {
      color: var(--muted);
      font-size: 13px;
    }

    .pill-small {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill-success {
      border-color: rgba(34, 197, 94, 0.7);
      color: #bbf7d0;
    }

    .pill-danger {
      border-color: rgba(248, 113, 113, 0.7);
      color: #fecaca;
    }

    .delta-pos {
      color: #bbf7d0;
    }

    .delta-neg {
      color: #fecaca;
    }

    .delta-zero {
      color: var(--muted);
    }

    .highlight-row {
      background: rgba(15, 23, 42, 0.85);
    }

    .tagline {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px;
    }

    .two-col {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 16px;
    }

    @media (max-width: 900px) {
      header {
        flex-direction: column;
      }
      .podcast-card {
        width: 100%;
      }
      .grid,
      .grid-3,
      .two-col {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      body {
        padding: 12px;
      }
      header {
        padding: 16px;
      }
      .brand-title {
        font-size: 22px;
      }
      .card {
        padding: 14px;
      }
      table {
        font-size: 13px;
      }
      th, td {
        padding: 5px 4px;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <div class="brand-title">Fantasy Brick Association</div>
        <div class="brand-subtitle">
          FBA Hub – alle Zahlen, Serien und Power Rankings der Liga auf einen Blick.
        </div>
        <div class="brand-meta">
          <span class="pill">Regular Season 25/26</span>
          <span class="pill" id="best-team-pill">Beste Bilanz: –</span>
          <span class="pill" id="streak-pill">Längste Serie: –</span>
        </div>
      </div>
      <div class="podcast-card">
        <div class="podcast-header">
          <div>
            <div class="podcast-title">FBA Podcast – aktuelle Folge</div>
            <div class="tagline">Recap, Power Ranking & Preview direkt aus dem Wolfsbau.</div>
          </div>
          <div class="podcast-badge">Podcast</div>
        </div>
        <div class="podcast-iframe-wrapper">
          <!-- Wird dynamisch aus EXPORT_settings gefüllt -->
          <iframe id="podcast-embed"
                  src=""
                  width="100%"
                  height="152"
                  allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
                  loading="lazy"></iframe>
        </div>
      </div>
    </header>

    <main>
      <!-- Live Dashboard (Matchups) + Power Ranking klassisch -->
      <div class="grid">
        <section class="card" id="live-dashboard">
          <div class="card-header">
            <div>
              <div class="card-title">Live Matchups</div>
              <div class="card-subtitle">Aktuelles Matchup mit Prognose auf Basis der Saisonform.</div>
            </div>
            <span class="badge">Regular Season</span>
          </div>
          <div class="section-body">
            <table id="matchups-table">
              <thead>
                <tr>
                  <th>Matchup</th>
                  <th>Auswärts</th>
                  <th>Heim</th>
                  <th>Prognose</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="4" class="muted">Daten werden geladen …</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <section class="card" id="power-ranking-card">
          <div class="card-header">
            <div>
              <div class="card-title">Power Ranking</div>
              <div class="card-subtitle">Leistungs-Check der letzten Woche – unabhängig vom Matchup.</div>
            </div>
            <span class="badge">Woche W-1</span>
          </div>
          <div class="section-body">
            <table id="power-ranking-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Team</th>
                  <th>Score</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="3" class="muted">Daten werden geladen …</td></tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>

      <!-- Standings + Power Ranking Plus -->
      <div class="grid">
        <section class="card" id="standings-card">
          <div class="card-header">
            <div>
              <div class="card-title">Aktuelle Tabelle</div>
              <div class="card-subtitle">Live-Standings aus ESPN, inklusive Serien.</div>
            </div>
            <span class="badge">Standings</span>
          </div>
          <div class="section-body">
            <table id="standings-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Team</th>
                  <th>Bilanz</th>
                  <th>W%</th>
                  <th>Serie</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="5" class="muted">Daten werden geladen …</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <section class="card" id="power-ranking-plus-card">
          <div class="card-header">
            <div>
              <div class="card-title">Power Ranking+</div>
              <div class="card-subtitle">Feintuning mit Abständen – wer ist wirklich heiß?</div>
            </div>
            <span class="badge">Advanced</span>
          </div>
          <div class="section-body">
            <table id="power-ranking-plus-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Team</th>
                  <th>Score+</th>
                  <th>Δ</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="4" class="muted">Daten werden geladen …</td></tr>
              </tbody>
            </table>
          </div>
        </section>
      </div>

      <!-- Hall of Fame / Ewige Tabelle kannst du später noch ergänzen -->
    </main>
  </div>

  <script>
    // === CSV-Quellen ===
    const SETTINGS_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=0&single=true&output=csv";

    const STANDINGS_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=683402103&single=true&output=csv";

    const MATCHUPS_LIVE_CSV_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=478155593&single=true&output=csv";

    // TODO: diese beiden Links ersetzt du, sobald du die Tabs im Live-Sheet veröffentlicht hast
    const POWER_RANKING_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=1192817047&single=true&output=csv";
    const POWER_RANKING_PLUS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=1541127392&single=true&output=csv";

    // === Team-Logos ===
    const teamLogos = {
      "BlackForest Mad Wolves": "logos/Logo BlackForest Mad Wolves.png",
      "Balingen Lions": "logos/Logo Balingen Lions.png",
      "East Bay Pirates": "logos/Logo East Bay Pirates.png",
      "Toronto Polar Bears": "logos/Logo Toronto Polar Bears.png",
      "Wild Cheetahs": "logos/Logo Wild Cheetahs.png",
      "Karlsruhe Unicorns": "logos/Logo Karlsruhe Unicorns.png",
      "Dormettingen Eagles": "logos/Logo Dormettingen Eagles.png",
      "Guardians of Rhinos": "logos/Logo Guardians of Rhinos.png"
    };

    function getLogoSrc(teamName) {
      return teamLogos[teamName] || "logos/placeholder.png";
    }

    // === CSV-Helper ===
    async function fetchCSV(url) {
      if (!url || url.startsWith("https://dein-link")) {
        return null;
      }
      const res = await fetch(url);
      const text = await res.text();

      const rows = text
        .trim()
        .split(/\r?\n/)
        .map((line) => {
          const result = [];
          let current = "";
          let inQuotes = false;
          for (let i = 0; i < line.length; i++) {
            const ch = line[i];
            if (ch === '"' && line[i + 1] === '"') {
              current += '"';
              i++;
            } else if (ch === '"') {
              inQuotes = !inQuotes;
            } else if (ch === "," && !inQuotes) {
              result.push(current);
              current = "";
            } else {
              current += ch;
            }
          }
          result.push(current);
          return result;
        });

      const headers = rows[0];
      const data = rows.slice(1).map((row) => {
        const obj = {};
        headers.forEach((h, i) => {
          obj[h.trim()] = row[i] !== undefined ? row[i].trim() : "";
        });
        return obj;
      });
      return data;
    }

    // === Settings laden (Best Team, Streaks, Podcast) ===
    async function loadSettings() {
      const data = await fetchCSV(SETTINGS_CSV_URL);
      if (!data || !data.length) return;
      const row = data[0];

      const bestTeam = row.best_team || "–";
      const bestWinPct = row.best_win_pct || "";
      const winStreakTeam = row.win_streak_team || "";
      const winStreakLabel = row.win_streak_label || "";
      const lossStreakTeam = row.loss_streak_team || "";
      const lossStreakLabel = row.loss_streak_label || "";
      const podcastEmbedSrc = row.podcast_embed_src || "";

      const bestTeamPill = document.getElementById("best-team-pill");
      if (bestTeamPill) {
        bestTeamPill.textContent =
          bestWinPct
            ? `Beste Bilanz: ${bestTeam} (${(parseFloat(bestWinPct) * 100).toFixed(1)} %)`
            : `Beste Bilanz: ${bestTeam}`;
      }

      const streakPill = document.getElementById("streak-pill");
      if (streakPill) {
        let txt = "Längste Serie: –";
        if (winStreakTeam && winStreakLabel) {
          txt = `Längste Serie: ${winStreakTeam} (${winStreakLabel})`;
        }
        if (lossStreakTeam && lossStreakLabel) {
          txt += ` · Negativ: ${lossStreakTeam} (${lossStreakLabel})`;
        }
        streakPill.textContent = txt;
      }

      const iframe = document.getElementById("podcast-embed");
      if (iframe && podcastEmbedSrc) {
        iframe.src = podcastEmbedSrc;
      }
    }

    // === Standings laden ===
    async function loadStandings() {
      const tableBody = document.querySelector("#standings-table tbody");
      if (!tableBody) return;

      const data = await fetchCSV(STANDINGS_CSV_URL);
      if (!data) {
        tableBody.innerHTML = '<tr><td colspan="5" class="muted">Keine Standings verfügbar.</td></tr>';
        return;
      }

      // Erwartete Spalten: rank, team_name, wins, losses, win_pct, streak_label
      tableBody.innerHTML = "";
      data.forEach((row) => {
        if (!row.team_name) return;
        const tr = document.createElement("tr");

        const rankTd = document.createElement("td");
        rankTd.textContent = row.rank || "";
        tr.appendChild(rankTd);

        const teamTd = document.createElement("td");
        teamTd.innerHTML = `
          <div class="team-cell">
            <img class="team-logo" src="${getLogoSrc(row.team_name)}" alt="">
            <span class="team-name">${row.team_name}</span>
          </div>
        `;
        tr.appendChild(teamTd);

        const recordTd = document.createElement("td");
        recordTd.textContent = `${row.wins || "0"}-${row.losses || "0"}`;
        tr.appendChild(recordTd);

        const winPctTd = document.createElement("td");
        if (row.win_pct) {
          const num = parseFloat(row.win_pct);
          winPctTd.textContent = (num * 100).toFixed(1) + " %";
        } else {
          winPctTd.textContent = "–";
        }
        tr.appendChild(winPctTd);

        const streakTd = document.createElement("td");
        streakTd.textContent = row.streak_label || "–";
        tr.appendChild(streakTd);

        tableBody.appendChild(tr);
      });

      if (!tableBody.children.length) {
        tableBody.innerHTML = '<tr><td colspan="5" class="muted">Keine Standings verfügbar.</td></tr>';
      }
    }

    // === Matchups live laden ===
    async function loadMatchups() {
      const tableBody = document.querySelector("#matchups-table tbody");
      if (!tableBody) return;

      const data = await fetchCSV(MATCHUPS_LIVE_CSV_URL);
      if (!data) {
        tableBody.innerHTML = '<tr><td colspan="4" class="muted">Keine Matchups verfügbar.</td></tr>';
        return;
      }

      // Erwartete Spalten: matchup, away_team, home_team, projection_label (oder ähnlich)
      tableBody.innerHTML = "";
      data.forEach((row) => {
        if (!row.away_team || !row.home_team) return;

        const tr = document.createElement("tr");

        const matchupTd = document.createElement("td");
        matchupTd.textContent = row.matchup || `${row.away_team} @ ${row.home_team}`;
        tr.appendChild(matchupTd);

        const awayTd = document.createElement("td");
        awayTd.innerHTML = `
          <div class="team-cell">
            <img class="team-logo" src="${getLogoSrc(row.away_team)}" alt="">
            <span class="team-name">${row.away_team}</span>
          </div>
        `;
        tr.appendChild(awayTd);

        const homeTd = document.createElement("td");
        homeTd.innerHTML = `
          <div class="team-cell">
            <img class="team-logo" src="${getLogoSrc(row.home_team)}" alt="">
            <span class="team-name">${row.home_team}</span>
          </div>
        `;
        tr.appendChild(homeTd);

        const projTd = document.createElement("td");
        const label = row.projection_label || row.prognose || "";
        projTd.innerHTML = label
          ? `<span class="pill-small">${label}</span>`
          : '<span class="muted">–</span>';
        tr.appendChild(projTd);

        tableBody.appendChild(tr);
      });

      if (!tableBody.children.length) {
        tableBody.innerHTML = '<tr><td colspan="4" class="muted">Keine Matchups verfügbar.</td></tr>';
      }
    }

    // === Power Ranking klassisch laden ===
    async function loadPowerRanking() {
      const tableBody = document.querySelector("#power-ranking-table tbody");
      if (!tableBody) return;

      const data = await fetchCSV(POWER_RANKING_CSV_URL);
      if (!data) {
        tableBody.innerHTML =
          '<tr><td colspan="3" class="muted">Noch kein Power Ranking veröffentlicht.</td></tr>';
        return;
      }

      // Erwartete Spalten: rank, team_name, score, note
      tableBody.innerHTML = "";
      data
        .filter((row) => row.team_name)
        .sort((a, b) => (parseInt(a.rank || 99) - parseInt(b.rank || 99)))
        .forEach((row) => {
          const tr = document.createElement("tr");
          if (row.rank === "1") {
            tr.classList.add("highlight-row");
          }

          const rankTd = document.createElement("td");
          rankTd.textContent = row.rank || "";
          tr.appendChild(rankTd);

          const teamTd = document.createElement("td");
          teamTd.innerHTML = `
            <div class="team-cell">
              <img class="team-logo" src="${getLogoSrc(row.team_name)}" alt="">
              <span class="team-name">${row.team_name}</span>
            </div>
            ${row.note ? `<div class="muted">${row.note}</div>` : ""}
          `;
          tr.appendChild(teamTd);

          const scoreTd = document.createElement("td");
          if (row.score) {
            const num = parseFloat(row.score.replace(",", "."));
            scoreTd.textContent = isNaN(num) ? row.score : num.toFixed(3);
          } else {
            scoreTd.textContent = "–";
          }
          tr.appendChild(scoreTd);

          tableBody.appendChild(tr);
        });

      if (!tableBody.children.length) {
        tableBody.innerHTML =
          '<tr><td colspan="3" class="muted">Noch kein Power Ranking veröffentlicht.</td></tr>';
      }
    }

    // === Power Ranking+ laden ===
    async function loadPowerRankingPlus() {
      const tableBody = document.querySelector("#power-ranking-plus-table tbody");
      if (!tableBody) return;

      const data = await fetchCSV(POWER_RANKING_PLUS_CSV_URL);
      if (!data) {
        tableBody.innerHTML =
          '<tr><td colspan="4" class="muted">Noch kein Power Ranking+ veröffentlicht.</td></tr>';
        return;
      }

      // Erwartete Spalten: rank, team_name, score, delta
      tableBody.innerHTML = "";
      data
        .filter((row) => row.team_name)
        .sort((a, b) => (parseInt(a.rank || 99) - parseInt(b.rank || 99)))
        .forEach((row) => {
          const tr = document.createElement("tr");
          if (row.rank === "1") {
            tr.classList.add("highlight-row");
          }

          const rankTd = document.createElement("td");
          rankTd.textContent = row.rank || "";
          tr.appendChild(rankTd);

          const teamTd = document.createElement("td");
          teamTd.innerHTML = `
            <div class="team-cell">
              <img class="team-logo" src="${getLogoSrc(row.team_name)}" alt="">
              <span class="team-name">${row.team_name}</span>
            </div>
          `;
          tr.appendChild(teamTd);

          const scoreTd = document.createElement("td");
          if (row.score) {
            const num = parseFloat(row.score.replace(",", "."));
            scoreTd.textContent = isNaN(num) ? row.score : num.toFixed(3);
          } else {
            scoreTd.textContent = "–";
          }
          tr.appendChild(scoreTd);

          const deltaTd = document.createElement("td");
          const deltaRaw = row.delta || "0";
          const delta = parseInt(deltaRaw, 10);
          let cls = "delta-zero";
          let txt = "0";
          if (!isNaN(delta)) {
            if (delta > 0) {
              cls = "delta-pos";
              txt = "+" + delta;
            } else if (delta < 0) {
              cls = "delta-neg";
              txt = delta.toString();
            }
          } else {
            txt = deltaRaw;
          }
          deltaTd.innerHTML = `<span class="${cls}">${txt}</span>`;
          tr.appendChild(deltaTd);

          tableBody.appendChild(tr);
        });

      if (!tableBody.children.length) {
        tableBody.innerHTML =
          '<tr><td colspan="4" class="muted">Noch kein Power Ranking+ veröffentlicht.</td></tr>';
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadSettings();
      loadStandings();
      loadMatchups();
      loadPowerRanking();
      loadPowerRankingPlus();
    });
  </script>
</body>
</html>
