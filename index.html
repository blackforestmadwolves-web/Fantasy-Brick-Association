<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FBA Hub – Fantasy Brick Association</title>
  <style>
    :root{
      --bg:#05060a;
      --panel:#0b0f17;
      --card:#0f1420;
      --card2:#0c111b;
      --text:#eef2ff;
      --muted:#a7b0c4;
      --border:rgba(255,255,255,.08);
      --shadow: 0 20px 60px rgba(0,0,0,.55);
      --radius:18px;

      /* gedämpftes FBA-Orange */
      --accent:#ff8a2a;
      --accent2:#ffb067;

      --font: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

      /* Schrift minimal größer */
      --base: 16.5px;
      --h1: 34px;
      --h2: 20px;
      --h3: 14px;
    }

    *{ box-sizing:border-box; margin:0; padding:0; }
    html,body{ height:100%; }
    body{
      font-family: var(--font);
      font-size: var(--base);
      color: var(--text);
      background:
        radial-gradient(900px 600px at 15% 0%, rgba(255,138,42,.18), transparent 60%),
        radial-gradient(900px 600px at 85% 0%, rgba(255,176,103,.10), transparent 55%),
        radial-gradient(1200px 800px at 50% 100%, rgba(120,90,255,.10), transparent 55%),
        var(--bg);
      padding: 22px;
      display:flex;
      justify-content:center;
    }

    .page{ width:100%; max-width: 1240px; }
    .stack{ display:flex; flex-direction:column; gap:16px; }

    header.hero{
      position:relative;
      border:1px solid var(--border);
      border-radius: 22px;
      overflow:hidden;
      box-shadow: var(--shadow);
      background:
        linear-gradient(135deg,
          rgba(255,138,42,.16),
          rgba(255,176,103,.06) 40%,
          rgba(0,0,0,.0) 100%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
    }

    .hero-inner{
      display:grid;
      grid-template-columns: 1.35fr .65fr;
      gap: 16px;
      padding: 22px;
      align-items: start;
    }

    .brand h1{
      font-size: var(--h1);
      letter-spacing: .2px;
      line-height:1.12;
      margin-bottom: 10px;
    }
    .brand p{
      color: var(--muted);
      line-height: 1.4;
      max-width: 64ch;
    }

    .pill-row{
      display:flex; flex-wrap:wrap; gap:10px;
      margin-top: 14px;
    }
    .pill{
      border: 1px solid var(--border);
      background: rgba(0,0,0,.22);
      padding: 8px 10px;
      border-radius: 999px;
      color: var(--muted);
      font-size: 13px;
    }
    .pill strong{ color: var(--text); font-weight: 650; }

    .podcast{
      border:1px solid var(--border);
      background: rgba(0,0,0,.24);
      border-radius: 18px;
      padding: 12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.45);
    }
    .podcast-head{
      display:flex; justify-content:space-between; align-items:center;
      margin-bottom: 10px;
    }
    .podcast-head .title{
      font-weight: 750;
      letter-spacing: .2px;
    }
    .podcast-head a{
      color: var(--accent2);
      text-decoration: none;
      font-weight: 650;
      font-size: 13px;
      border:1px solid rgba(255,176,103,.25);
      padding:6px 10px;
      border-radius: 999px;
      background: rgba(255,138,42,.10);
    }
    .podcast iframe{
      width:100%;
      height: 152px;
      border:0;
      border-radius: 14px;
      background: #0a0a0a;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    @media (min-width: 980px){
      .grid{
        grid-template-columns: 1.1fr .9fr;
      }
    }

    .card{
      border:1px solid var(--border);
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .card-inner{ padding: 18px; }
    .card h2{
      font-size: var(--h2);
      margin-bottom: 6px;
      letter-spacing: .2px;
    }
    .sub{
      color: var(--muted);
      margin-bottom: 14px;
      line-height: 1.35;
    }

    .dash{
      display:grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    @media (min-width: 860px){
      .dash{ grid-template-columns: 1fr 1fr 1fr; }
    }

    .mini{
      border:1px solid var(--border);
      background: rgba(0,0,0,.22);
      border-radius: 16px;
      padding: 14px;
      min-height: 104px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
    }
    .mini .label{
      font-size: 12px;
      letter-spacing: .9px;
      text-transform: uppercase;
      color: var(--muted);
    }
    .mini .row{
      display:flex;
      align-items:center;
      gap: 10px;
      margin-top: 10px;
    }
    .mini .team{
      font-weight: 800;
      font-size: 18px;
      line-height: 1.1;
    }
    .mini .meta{
      color: var(--muted);
      margin-top: 4px;
      font-size: 14px;
    }

    .logo{
      width: 42px;
      height: 42px;
      border-radius: 12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.06);
      display:flex;
      align-items:center;
      justify-content:center;
      overflow:hidden;
      flex: 0 0 auto;
    }
    .logo img{
      width: 100%;
      height: 100%;
      object-fit: cover;
      display:block;
    }
    .logo .fallback{
      font-weight: 850;
      color: rgba(255,255,255,.85);
      font-size: 12px;
      letter-spacing: .6px;
    }

    table{
      width:100%;
      border-collapse: collapse;
      font-size: 15px;
    }
    thead th{
      text-align:left;
      color: var(--muted);
      font-weight: 700;
      font-size: 12px;
      letter-spacing: .9px;
      text-transform: uppercase;
      padding: 10px 10px;
      border-bottom: 1px solid var(--border);
    }
    tbody td{
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.06);
      vertical-align: middle;
    }
    tbody tr:hover{
      background: rgba(255,255,255,.03);
    }

    .teamcell{
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .muted{ color: var(--muted); }

    .toolbar{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-bottom: 12px;
    }
    .toggle{
      border:1px solid var(--border);
      background: rgba(0,0,0,.22);
      border-radius: 999px;
      padding: 6px;
      display:flex;
      gap: 6px;
      align-items:center;
    }
    .btn{
      cursor:pointer;
      border:1px solid transparent;
      background: transparent;
      color: var(--muted);
      padding: 8px 12px;
      border-radius: 999px;
      font-weight: 750;
      font-size: 13px;
      letter-spacing: .2px;
    }
    .btn.active{
      color: var(--text);
      border-color: rgba(255,176,103,.30);
      background: rgba(255,138,42,.12);
    }

    .right-col{
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .footer-note{
      color: rgba(255,255,255,.45);
      font-size: 12.5px;
      margin-top: 2px;
      padding: 0 2px 6px 2px;
    }

    .badge{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 7px 10px;
      border-radius: 999px;
      border:1px solid rgba(255,176,103,.22);
      background: rgba(255,138,42,.10);
      color: rgba(255,255,255,.85);
      font-size: 13px;
      font-weight: 650;
    }

    .error{
      border:1px solid rgba(255,80,80,.35);
      background: rgba(255,80,80,.08);
      padding: 10px 12px;
      border-radius: 14px;
      color: rgba(255,220,220,.95);
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div class="page stack">

    <!-- HERO + PODCAST -->
    <header class="hero">
      <div class="hero-inner">
        <div class="brand">
          <h1>FBA Hub</h1>
          <p>Schneller Überblick über die aktuelle Lage in der Fantasy Brick Association – Live Matchups, Live Standings und Power Rankings (PR / PR+).</p>

          <div class="pill-row">
            <div class="pill"><strong>Quelle:</strong> Google Sheets (CSV)</div>
            <div class="pill"><strong>Update:</strong> Live beim Reload</div>
            <div class="pill"><strong>Terminologie:</strong> Punkte (8)</div>
          </div>
        </div>

        <div class="podcast">
          <div class="podcast-head">
            <div class="title">Podcast</div>
            <a id="podcastLink" href="#" target="_blank" rel="noopener">Open in Spotify</a>
          </div>
          <iframe
            id="podcastFrame"
            src="https://open.spotify.com/embed/episode/5IFryO5ElCtLA9zNtCT2bf?"
            allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
            loading="lazy">
          </iframe>
        </div>
      </div>
    </header>

    <!-- LIVE DASHBOARD -->
    <section class="card">
      <div class="card-inner">
        <h2>Live Dashboard</h2>
        <div class="sub">Best-of-Kacheln aus den aktuellen Live Standings.</div>

        <div class="dash" id="dashboardCards">
          <!-- Filled by JS -->
        </div>

        <div class="footer-note" id="dashNote"></div>
      </div>
    </section>

    <!-- MAIN GRID -->
    <section class="grid">

      <!-- LEFT: MATCHUPS -->
      <div class="card">
        <div class="card-inner">
          <h2>Aktuell laufende Matchups</h2>
          <div class="sub">Reihenfolge: Auswärts → Score → Heim → Prognose.</div>

          <div id="matchupsError" class="error" style="display:none;"></div>

          <div style="overflow:auto;">
            <table>
              <thead>
                <tr>
                  <th>Auswärts</th>
                  <th>Score</th>
                  <th>Heim</th>
                  <th>Prognose</th>
                </tr>
              </thead>
              <tbody id="matchupsBody"></tbody>
            </table>
          </div>

          <div class="footer-note">Hinweis: Wenn im Sheet „Auswärts“ fälschlich „Team A vs. Team B“ steht, wird automatisch gesplittet.</div>
        </div>
      </div>

      <!-- RIGHT: STANDINGS + POWER RANKING TOGGLE -->
      <div class="right-col">

        <div class="card">
          <div class="card-inner">
            <h2>Live Standings</h2>
            <div class="sub">Gesamtübersicht (Standings Overall).</div>

            <div id="standingsError" class="error" style="display:none;"></div>

            <div style="overflow:auto;">
              <table>
                <thead>
                  <tr>
                    <th>Team</th>
                    <th>Conf</th>
                    <th>W</th>
                    <th>L</th>
                    <th>W%</th>
                    <th>Serie</th>
                  </tr>
                </thead>
                <tbody id="standingsBody"></tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="card">
          <div class="card-inner">
            <h2>Power Ranking</h2>
            <div class="sub">Toggle zwischen PR (klassisch) und PR+ (abstandsgewichtet).</div>

            <div class="toolbar">
              <div class="toggle">
                <button class="btn active" id="btnPR" type="button">PR</button>
                <button class="btn" id="btnPRP" type="button">PR+</button>
              </div>
              <span class="badge" id="prBadge">lädt …</span>
            </div>

            <div id="prError" class="error" style="display:none;"></div>

            <div style="overflow:auto;">
              <table>
                <thead id="prHead"></thead>
                <tbody id="prBody"></tbody>
              </table>
            </div>

          </div>
        </div>

      </div>
    </section>

  </div>

  <script>
    // ============
    // CONFIG
    // ============

    // Podcast (hart gesetzt, wie von dir geliefert)
    const PODCAST_URL = "https://open.spotify.com/episode/5IFryO5ElCtLA9zNtCT2bf";
    const PODCAST_EMBED_SRC = "https://open.spotify.com/embed/episode/5IFryO5ElCtLA9zNtCT2bf?";

    // CSV Quellen (von dir geliefert)
    const MATCHUPS_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=478155593&single=true&output=csv";

    const STANDINGS_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=683402103&single=true&output=csv";

    const POWER_RANKING_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=1192817047&single=true&output=csv";

    const POWER_RANKING_PLUS_URL =
      "https://docs.google.com/spreadsheets/d/e/2PACX-1vShK9dZvsVWaW-dOTecnC2XAxyBNB7uoL9u8I2n5py4cv1z5iuB8ivY-LBYyRGrkutNM0dS40VpV0n0/pub?gid=1541127392&single=true&output=csv";

    // Logos exakt passend zu deinem Repo /logos/*
    const teamLogos = {
      "Balingen Lions": "logos/Balingen Lions.png",
      "BlackForest Mad Wolves": "logos/BlackForest Mad Wolves.png",
      "Dormettingen Eagles": "logos/Dormettingen Eagles.png",
      "East Bay Pirates": "logos/East Bay Pirates.png",
      "Guardians of Rhinos": "logos/Guardians of Rhinos.png",
      "Karlsruhe Unicorns": "logos/Karlsruhe Unicorns.png",
      "Toronto Polar Bears": "logos/Toronto Polar Bears.png",
      "Wild Cheetahs": "logos/Wild Cheetahs.png"
    };

    // ============
    // HELPERS
    // ============

    function cacheBust(url){
      const u = new URL(url);
      u.searchParams.set("_ts", Date.now().toString());
      return u.toString();
    }

    async function fetchText(url){
      const res = await fetch(cacheBust(url), { cache: "no-store" });
      if(!res.ok) throw new Error(`HTTP ${res.status} – ${url}`);
      return await res.text();
    }

    // simple CSV parser (handles commas, quotes, newlines)
    function parseCSV(text){
      const rows = [];
      let row = [];
      let cur = "";
      let inQuotes = false;

      for(let i=0; i<text.length; i++){
        const c = text[i];
        const n = text[i+1];

        if(c === '"' && inQuotes && n === '"'){
          cur += '"';
          i++;
          continue;
        }
        if(c === '"'){
          inQuotes = !inQuotes;
          continue;
        }
        if(c === ',' && !inQuotes){
          row.push(cur);
          cur = "";
          continue;
        }
        if((c === '\n' || c === '\r') && !inQuotes){
          if(c === '\r' && n === '\n') i++;
          row.push(cur);
          cur = "";
          if(row.some(v => v !== "")){
            rows.push(row);
          }
          row = [];
          continue;
        }
        cur += c;
      }
      row.push(cur);
      if(row.some(v => v !== "")) rows.push(row);

      if(rows.length === 0) return [];
      const header = rows[0].map(h => h.trim());
      return rows.slice(1).map(r => {
        const obj = {};
        header.forEach((h, idx) => obj[h] = (r[idx] ?? "").trim());
        return obj;
      });
    }

    function safeNumber(x){
      if(x === null || x === undefined) return null;
      const s = String(x).trim();
      if(s === "") return null;
      // allow ".679" style
      const normalized = s.startsWith(".") ? "0"+s : s;
      const n = Number(normalized);
      return Number.isFinite(n) ? n : null;
    }

    function initials(name){
      return name.split(" ").filter(Boolean).slice(0,2).map(p => p[0].toUpperCase()).join("");
    }

    function renderLogo(team){
      const src = teamLogos[team];
      const div = document.createElement("div");
      div.className = "logo";
      if(!src){
        const fb = document.createElement("div");
        fb.className = "fallback";
        fb.textContent = initials(team);
        div.appendChild(fb);
        return div;
      }
      const img = document.createElement("img");
      img.src = src;
      img.alt = team + " Logo";
      img.onerror = () => {
        div.innerHTML = "";
        const fb = document.createElement("div");
        fb.className = "fallback";
        fb.textContent = initials(team);
        div.appendChild(fb);
      };
      div.appendChild(img);
      return div;
    }

    function parseStreakLabel(label){
      // label like "3-Siege", "2-Niederlagen", "1-Unentschieden"
      const s = (label || "").trim();
      const m = s.match(/^(\d+)\s*-\s*(Siege|Niederlagen|Unentschieden)/i);
      if(!m) return { value: 0, type: "unknown" };
      const n = parseInt(m[1],10);
      const t = m[2].toLowerCase();
      if(t.startsWith("sieg")) return { value: n, type: "win" };
      if(t.startsWith("nieder")) return { value: -n, type: "loss" };
      if(t.startsWith("unent")) return { value: 0, type: "tie" };
      return { value: 0, type: "unknown" };
    }

    // Split "Team A vs. Team B" if it accidentally sits in one cell
    function splitVs(text){
      const s = (text || "").trim();
      const patterns = [" vs. ", " vs ", "VS.", "VS ", "vs.", "vs "];
      for(const p of patterns){
        const idx = s.indexOf(p);
        if(idx > 0){
          const a = s.slice(0, idx).trim();
          const b = s.slice(idx + p.length).trim();
          if(a && b) return [a,b];
        }
      }
      return null;
    }

    // ============
    // RENDERERS
    // ============

    function setPodcast(){
      document.getElementById("podcastLink").href = PODCAST_URL;
      document.getElementById("podcastFrame").src = PODCAST_EMBED_SRC;
    }

    function renderDashboardFromStandings(standings){
      const dash = document.getElementById("dashboardCards");
      dash.innerHTML = "";

      if(!standings || standings.length === 0){
        dash.innerHTML = `<div class="error">Keine Standings-Daten gefunden.</div>`;
        return;
      }

      // Best record by win_pct
      let best = null;
      for(const r of standings){
        const wp = safeNumber(r.win_pct);
        if(wp === null) continue;
        if(!best || wp > best.wp) best = { team: r.team_name, wp };
      }

      // Longest winning streak / losing streak from streak_label
      let bestWin = null;
      let bestLoss = null;
      for(const r of standings){
        const st = parseStreakLabel(r.streak_label);
        if(st.type === "win"){
          if(!bestWin || st.value > bestWin.len) bestWin = { team: r.team_name, len: st.value };
        }
        if(st.type === "loss"){
          if(!bestLoss || Math.abs(st.value) > bestLoss.len) bestLoss = { team: r.team_name, len: Math.abs(st.value) };
        }
      }

      const cards = [
        {
          label: "Beste Bilanz",
          team: best?.team ?? "—",
          meta: best ? `Siegesquote: ${(best.wp*100).toFixed(1)}%` : "—"
        },
        {
          label: "Längste Siegesserie",
          team: bestWin?.team ?? "—",
          meta: bestWin ? `${bestWin.len}-Siege` : "—"
        },
        {
          label: "Längste Niederlagenserie",
          team: bestLoss?.team ?? "—",
          meta: bestLoss ? `${bestLoss.len}-Niederlagen` : "—"
        }
      ];

      for(const c of cards){
        const box = document.createElement("div");
        box.className = "mini";

        const label = document.createElement("div");
        label.className = "label";
        label.textContent = c.label;

        const row = document.createElement("div");
        row.className = "row";

        row.appendChild(renderLogo(c.team));

        const txt = document.createElement("div");
        const team = document.createElement("div");
        team.className = "team";
        team.textContent = c.team;

        const meta = document.createElement("div");
        meta.className = "meta";
        meta.textContent = c.meta;

        txt.appendChild(team);
        txt.appendChild(meta);
        row.appendChild(txt);

        box.appendChild(label);
        box.appendChild(row);
        dash.appendChild(box);
      }

      document.getElementById("dashNote").textContent =
        "Tipp: Wenn Logos als Initialen erscheinen, passt der Teamname aus dem CSV nicht exakt zum Logo-Mapping.";
    }

    function renderStandingsTable(standings){
      const body = document.getElementById("standingsBody");
      body.innerHTML = "";

      for(const r of standings){
        const tr = document.createElement("tr");

        const tdTeam = document.createElement("td");
        const wrap = document.createElement("div");
        wrap.className = "teamcell";
        wrap.appendChild(renderLogo(r.team_name || "—"));

        const name = document.createElement("div");
        name.innerHTML = `<div style="font-weight:800;">${r.team_name || "—"}</div>`;
        wrap.appendChild(name);
        tdTeam.appendChild(wrap);

        const tdConf = document.createElement("td");
        tdConf.textContent = r.conf || "—";
        tdConf.className = "muted";

        const tdW = document.createElement("td");
        tdW.textContent = r.W || "—";

        const tdL = document.createElement("td");
        tdL.textContent = r.L || "—";

        const tdWP = document.createElement("td");
        const wp = safeNumber(r.win_pct);
        tdWP.textContent = (wp === null) ? "—" : (wp*100).toFixed(1) + "%";

        const tdSt = document.createElement("td");
        tdSt.textContent = r.streak_label || "—";
        tdSt.className = "muted";

        tr.appendChild(tdTeam);
        tr.appendChild(tdConf);
        tr.appendChild(tdW);
        tr.appendChild(tdL);
        tr.appendChild(tdWP);
        tr.appendChild(tdSt);

        body.appendChild(tr);
      }
    }

    function renderMatchupsTable(matchups){
      const body = document.getElementById("matchupsBody");
      body.innerHTML = "";

      for(const r of matchups){
        let away = r.away_team || "";
        let home = r.home_team || "";

        // If away column accidentally contains "Team A vs. Team B"
        const split = splitVs(away);
        if(split && (!home || home === "")){
          away = split[0];
          home = split[1];
        }

        const tr = document.createElement("tr");

        const tdAway = document.createElement("td");
        const awayWrap = document.createElement("div");
        awayWrap.className = "teamcell";
        awayWrap.appendChild(renderLogo(away || "—"));
        const awayName = document.createElement("div");
        awayName.innerHTML = `<div style="font-weight:800;">${away || "—"}</div>`;
        awayWrap.appendChild(awayName);
        tdAway.appendChild(awayWrap);

        const tdScore = document.createElement("td");
        tdScore.textContent = r.score || "—";

        const tdHome = document.createElement("td");
        const homeWrap = document.createElement("div");
        homeWrap.className = "teamcell";
        homeWrap.appendChild(renderLogo(home || "—"));
        const homeName = document.createElement("div");
        homeName.innerHTML = `<div style="font-weight:800;">${home || "—"}</div>`;
        homeWrap.appendChild(homeName);
        tdHome.appendChild(homeWrap);

        const tdProj = document.createElement("td");
        tdProj.textContent = r.projection || "—";
        tdProj.className = "muted";

        tr.appendChild(tdAway);
        tr.appendChild(tdScore);
        tr.appendChild(tdHome);
        tr.appendChild(tdProj);

        body.appendChild(tr);
      }
    }

    function renderPRTable(rows, mode){
      // mode: "pr" or "pr+"
      const head = document.getElementById("prHead");
      const body = document.getElementById("prBody");
      head.innerHTML = "";
      body.innerHTML = "";

      // Header
      const trh = document.createElement("tr");
      if(mode === "pr"){
        trh.innerHTML = `
          <th>Rang</th>
          <th>Team</th>
          <th>Score</th>
        `;
      } else {
        trh.innerHTML = `
          <th>Rang</th>
          <th>Team</th>
          <th>Score</th>
          <th>Delta</th>
        `;
      }
      head.appendChild(trh);

      // Body
      for(const r of rows){
        const tr = document.createElement("tr");

        const tdRank = document.createElement("td");
        tdRank.textContent = r.rank || "—";

        const tdTeam = document.createElement("td");
        const wrap = document.createElement("div");
        wrap.className = "teamcell";
        wrap.appendChild(renderLogo(r.team_name || "—"));
        const nm = document.createElement("div");
        nm.innerHTML = `<div style="font-weight:800;">${r.team_name || "—"}</div>`;
        wrap.appendChild(nm);
        tdTeam.appendChild(wrap);

        const tdScore = document.createElement("td");
        tdScore.textContent = r.score || "—";

        tr.appendChild(tdRank);
        tr.appendChild(tdTeam);
        tr.appendChild(tdScore);

        if(mode === "pr+"){
          const tdDelta = document.createElement("td");
          // delta kann "0" oder "+2" oder "-1" etc.
          tdDelta.textContent = (r.delta ?? "—");
          tdDelta.className = "muted";
          tr.appendChild(tdDelta);
        }

        body.appendChild(tr);
      }
    }

    // ============
    // LOAD
    // ============

    async function loadAll(){
      setPodcast();

      // Load Standings (also used for dashboard)
      try{
        const txt = await fetchText(STANDINGS_URL);
        const standings = parseCSV(txt);
        document.getElementById("standingsError").style.display = "none";
        renderStandingsTable(standings);
        renderDashboardFromStandings(standings);
      }catch(e){
        const el = document.getElementById("standingsError");
        el.style.display = "block";
        el.textContent = "Standings konnten nicht geladen werden: " + e.message;
      }

      // Load Matchups
      try{
        const txt = await fetchText(MATCHUPS_URL);
        const matchups = parseCSV(txt);
        document.getElementById("matchupsError").style.display = "none";
        renderMatchupsTable(matchups);
      }catch(e){
        const el = document.getElementById("matchupsError");
        el.style.display = "block";
        el.textContent = "Matchups konnten nicht geladen werden: " + e.message;
      }

      // Load PR + PR+
      const btnPR = document.getElementById("btnPR");
      const btnPRP = document.getElementById("btnPRP");
      const badge = document.getElementById("prBadge");
      const err = document.getElementById("prError");

      let prRows = [];
      let prpRows = [];

      try{
        const [t1, t2] = await Promise.all([fetchText(POWER_RANKING_URL), fetchText(POWER_RANKING_PLUS_URL)]);
        prRows = parseCSV(t1);
        prpRows = parseCSV(t2);

        err.style.display = "none";
        badge.textContent = `PR: ${prRows.length} | PR+: ${prpRows.length}`;

        // default PR view
        renderPRTable(prRows, "pr");

        btnPR.onclick = () => {
          btnPR.classList.add("active");
          btnPRP.classList.remove("active");
          renderPRTable(prRows, "pr");
        };
        btnPRP.onclick = () => {
          btnPRP.classList.add("active");
          btnPR.classList.remove("active");
          renderPRTable(prpRows, "pr+");
        };

      }catch(e){
        err.style.display = "block";
        err.textContent = "Power Ranking Daten konnten nicht geladen werden: " + e.message;
        badge.textContent = "Fehler";
      }
    }

    loadAll();
  </script>
</body>
</html>
